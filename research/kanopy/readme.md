# Kanopy

https://github.com/ytdl-org/youtube-dl/issues/20423

## Android client

https://play.google.com/store/apps/details?id=com.kanopy

## Web client

Using this video:

https://kanopy.com/product/113763

Download encrypted media:

~~~
yt-dlp -o enc.mp4 --allow-unplayable-formats `
-f PLSFpqJb `
'https://kcms.kanopy.com/api/v1/playback/e2fdeaf9-d125-428f-8ae1-26dd73ede8ce/dash_nohdcp/master.mpd?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmxfaGFzaCI6IjAzZGRiOTA1NjU4NWNhNmEyYzAxNzY3N2VjNjIzNTY4Iiwic2VuZGVyX2lwIjoiMy4yMTUuMTQ1LjQ0IiwiaWF0IjoxNjU0Mjc3MzYwLCJleHAiOjE2NTQzNjM3NjB9.uBaLLHkE87TVH3t0KnUrAANtV0v3upIgO3QeLRWmQCs&cdn=cloudflare&service_name=backblaze_001'
~~~

Next we need the Widevine [1] PSSH from the manifest:

~~~xml
<ContentProtection schemeIdUri="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed">
   <cenc:pssh>
   AAAAU3Bzc2gAAAAA7e+LqXnWSs6jyCfc1R0h7QAAADMIARIQHK4cCNNqQVakP3flBtQFnxoLYnV5ZHJta2V5b3MiEH6emRTQOkqugjPdAK5rwWc=
   </cenc:pssh>
</ContentProtection>
~~~

Now go back to the video page, and you should see a request like this:

~~~
POST https://wv-keyos.licensekeyserver.com/ HTTP/2.0
customdata: PD94bWwgdmVyc2lvbj0iMS4wIj8+PEtleU9TQXV0aGVudGljYXRpb25YTUw+PERhdGE+PEdlbmVyYXRpb25UaW1lPjIwMjItMDYtMDMgMTc6Mjk6MjAuNjEwPC9HZW5lcmF0aW9uVGltZT48RXhwaXJhdGlvblRpbWU+MjAyMi0wNi0wMyAxNzozOToyMC42MTA8L0V4cGlyYXRpb25UaW1lPjxVbmlxdWVJZD4xMjQzNjY4Y2RhMzI0OGYzODMxY2M2MjI4Yjk1NTYyOTwvVW5pcXVlSWQ+PFJTQVB1YktleUlkPjBmYTIyYWUzNDRjMDU0OTE0NTUwYWIwZGY0OGNkOWRlPC9SU0FQdWJLZXlJZD48TGljZW5zZSB0eXBlPSJzaW1wbGUiPjxQbGF5PjxJZD4zZjUyZDAwZi00YmIwLTRhMzktODlkZi00ZjY2NWVkMGFhOTY8L0lkPjwvUGxheT48L0xpY2Vuc2U+PFBvbGljeT48TWluaW11bVNlY3VyaXR5TGV2ZWw+MjAwMDwvTWluaW11bVNlY3VyaXR5TGV2ZWw+PC9Qb2xpY3k+PFBsYXkgaWQ9IjNmNTJkMDBmLTRiYjAtNGEzOS04OWRmLTRmNjY1ZWQwYWE5NiI+PE91dHB1dFByb3RlY3Rpb25zPjxPUEw+PFVuY29tcHJlc3NlZERpZ2l0YWxWaWRlbz4xMDA8L1VuY29tcHJlc3NlZERpZ2l0YWxWaWRlbz48VW5jb21wcmVzc2VkRGlnaXRhbEF1ZGlvPjEwMDwvVW5jb21wcmVzc2VkRGlnaXRhbEF1ZGlvPjwvT1BMPjwvT3V0cHV0UHJvdGVjdGlvbnM+PC9QbGF5PjxXaWRldmluZVBvbGljeSBmbF9DYW5QbGF5PSJ0cnVlIi8+PFdpZGV2aW5lQ29udGVudEtleVNwZWMgVHJhY2tUeXBlPSJIRCI+PFNlY3VyaXR5TGV2ZWw+MTwvU2VjdXJpdHlMZXZlbD48L1dpZGV2aW5lQ29udGVudEtleVNwZWM+PEZhaXJQbGF5UG9saWN5Lz48S2V5SURMaXN0PjxLZXlJRD4xY2FlMWMwOC1kMzZhLTQxNTYtYTQzZi03N2U1MDZkNDA1OWY8L0tleUlEPjwvS2V5SURMaXN0PjwvRGF0YT48U2lnbmF0dXJlPmFSeVJYcjlpZVBIeXc0YnBFQnRwRXZaMllEaVQvaGxQYytKVE9QQUtHMVdjamFiandqS05RZmcyYVBYQngwVlgxWWFET2wvbHJnY0dUQ2xuQTlFdVhTQmFvQVFOU1VYR1VlTTE2SFBvUHRkSmoxd2dSR2ROUi9sS2h1bWNzR2FUOSt1YVZsNWh6NzVFVThCeTRSTVR0cy9PRElRWUcwK3hWbGVJZHljMG5XZFk3RVJWQitrdS9lbGI0dFVUVGZoU05mWUwybHhTb01MS0YxRElnc28yM3JrUDdWcVBkTDBiVC9sNzgwY1J6Y0Z6L3p3TDZzTkdCOERlaWU3NW9YaTFxQ0p4bEU1TmVDY3RrREl1WkZZTG1abWYweWdscDRIaFBTOHU1ay9HOHQwL0Z3aVArMzhSbllVWEwyaGVqaTJyRmRObWxJVU83WDB2aGFqaVBWTnRIZz09PC9TaWduYXR1cmU+PC9LZXlPU0F1dGhlbnRpY2F0aW9uWE1MPg==
~~~

Now go to Get Widevine Keys, and enter the information from above:

~~~
PSSH:
AAAAU3Bzc2gAAAAA7e+LqXnWSs6jyCfc1R0h7QAAADMIARIQHK4cCNNqQVakP3flBtQFnxoLYnV5ZHJta2V5b3MiEH6emRTQOkqugjPdAK5rwWc=

License:
https://wv-keyos.licensekeyserver.com/

Headers:
customdata: PD94bWwgdmVyc2lvbj0iMS4wIj8+PEtleU9TQXV0aGVudGljYXRpb25YTUw+PERhdGE+PEdlbmVyYXRpb25UaW1lPjIwMjItMDYtMDMgMTc6Mjk6MjAuNjEwPC9HZW5lcmF0aW9uVGltZT48RXhwaXJhdGlvblRpbWU+MjAyMi0wNi0wMyAxNzozOToyMC42MTA8L0V4cGlyYXRpb25UaW1lPjxVbmlxdWVJZD4xMjQzNjY4Y2RhMzI0OGYzODMxY2M2MjI4Yjk1NTYyOTwvVW5pcXVlSWQ+PFJTQVB1YktleUlkPjBmYTIyYWUzNDRjMDU0OTE0NTUwYWIwZGY0OGNkOWRlPC9SU0FQdWJLZXlJZD48TGljZW5zZSB0eXBlPSJzaW1wbGUiPjxQbGF5PjxJZD4zZjUyZDAwZi00YmIwLTRhMzktODlkZi00ZjY2NWVkMGFhOTY8L0lkPjwvUGxheT48L0xpY2Vuc2U+PFBvbGljeT48TWluaW11bVNlY3VyaXR5TGV2ZWw+MjAwMDwvTWluaW11bVNlY3VyaXR5TGV2ZWw+PC9Qb2xpY3k+PFBsYXkgaWQ9IjNmNTJkMDBmLTRiYjAtNGEzOS04OWRmLTRmNjY1ZWQwYWE5NiI+PE91dHB1dFByb3RlY3Rpb25zPjxPUEw+PFVuY29tcHJlc3NlZERpZ2l0YWxWaWRlbz4xMDA8L1VuY29tcHJlc3NlZERpZ2l0YWxWaWRlbz48VW5jb21wcmVzc2VkRGlnaXRhbEF1ZGlvPjEwMDwvVW5jb21wcmVzc2VkRGlnaXRhbEF1ZGlvPjwvT1BMPjwvT3V0cHV0UHJvdGVjdGlvbnM+PC9QbGF5PjxXaWRldmluZVBvbGljeSBmbF9DYW5QbGF5PSJ0cnVlIi8+PFdpZGV2aW5lQ29udGVudEtleVNwZWMgVHJhY2tUeXBlPSJIRCI+PFNlY3VyaXR5TGV2ZWw+MTwvU2VjdXJpdHlMZXZlbD48L1dpZGV2aW5lQ29udGVudEtleVNwZWM+PEZhaXJQbGF5UG9saWN5Lz48S2V5SURMaXN0PjxLZXlJRD4xY2FlMWMwOC1kMzZhLTQxNTYtYTQzZi03N2U1MDZkNDA1OWY8L0tleUlEPjwvS2V5SURMaXN0PjwvRGF0YT48U2lnbmF0dXJlPmFSeVJYcjlpZVBIeXc0YnBFQnRwRXZaMllEaVQvaGxQYytKVE9QQUtHMVdjamFiandqS05RZmcyYVBYQngwVlgxWWFET2wvbHJnY0dUQ2xuQTlFdVhTQmFvQVFOU1VYR1VlTTE2SFBvUHRkSmoxd2dSR2ROUi9sS2h1bWNzR2FUOSt1YVZsNWh6NzVFVThCeTRSTVR0cy9PRElRWUcwK3hWbGVJZHljMG5XZFk3RVJWQitrdS9lbGI0dFVUVGZoU05mWUwybHhTb01MS0YxRElnc28yM3JrUDdWcVBkTDBiVC9sNzgwY1J6Y0Z6L3p3TDZzTkdCOERlaWU3NW9YaTFxQ0p4bEU1TmVDY3RrREl1WkZZTG1abWYweWdscDRIaFBTOHU1ay9HOHQwL0Z3aVArMzhSbllVWEwyaGVqaTJyRmRObWxJVU83WDB2aGFqaVBWTnRIZz09PC9TaWduYXR1cmU+PC9LZXlPU0F1dGhlbnRpY2F0aW9uWE1MPg==
~~~

You should get a result like this:

~~~
1cae1c08d36a4156a43f77e506d4059f:d5cd2603845d322e3bff609581e1c7f5
~~~

Finally, you can decrypt [2] the media:

~~~
mp4decrypt --key 1:d5cd2603845d322e3bff609581e1c7f5 enc.mp4 dec.mp4
~~~

1. <https://dashif.org/identifiers/content_protection>
2. https://bento4.com/downloads

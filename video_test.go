package youtube

import (
   "fmt"
   "net/http"
   "testing"
)

const desc = "Provided to YouTube by Epitaph\n\nSnowflake · Kate Bush\n\n" +
"50 Words For Snow\n\n" +
"℗ Noble & Brite Ltd. trading as Fish People, under exclusive license to Anti Inc.\n\n" +
"Released on: 2011-11-22\n\nMusic  Publisher: Noble and Brite Ltd.\n" +
"Composer  Lyricist: Kate Bush\n\nAuto-generated by YouTube."

func TestFormat(t *testing.T) {
   v, e := NewVideo("kGEJNZd1hTA")
   if e != nil {
      t.Error(e)
   }
   // this should fail
   f, e := v.NewFormat(251)
   if e != nil {
      fmt.Println(e)
   } else {
      t.Error(f)
   }
}

func TestRequest(t *testing.T) {
   v, e := NewVideo("XeojXq6ySs4")
   if e != nil {
      t.Error(e)
   }
   if v.Description() != desc {
      t.Errorf("%+v\n", v)
   }
   if v.ViewCount() == 0 {
      t.Errorf("%+v\n", v)
   }
   f, e := v.NewFormat(251)
   if e != nil {
      t.Error(e)
   }
   req, e := f.NewRequest()
   if e != nil {
      t.Error(e)
   }
   fmt.Println("Get", req.URL.String())
   res, e := new(http.Client).Do(req)
   if e != nil {
      t.Error(e)
   }
   switch res.StatusCode {
   case http.StatusOK, http.StatusPartialContent:
   default:
      t.Error(res.StatusCode)
   }
}
